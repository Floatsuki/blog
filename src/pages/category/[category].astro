---
import { getCollection } from 'astro:content'
import IndexLayout from '@/layouts/IndexLayout.astro'
import PostList from '@/components/widgets/PostList.astro'
import { themeConfig } from '@/config'
import { getSortedFilteredPosts } from '@/utils/draft'

export async function getStaticPaths() {
  const allPosts = await getCollection('posts')
  const categories = [...new Set(allPosts.map((post) => post.data.category).filter(Boolean))]

  return categories.map((category) => ({
    params: { category },
    props: { category }
  }))
}

const { category } = Astro.props

const allPosts = await getSortedFilteredPosts()
const filteredPosts = allPosts.filter((post) => post.data.category === category)
---

<IndexLayout
  title={`${category} - ${themeConfig.site.title}`}
  description={`Posts categorized under ${category}`}
>
  <main>
    <h1>/{category}</h1>
    <PostList posts={filteredPosts} />
  </main>
</IndexLayout>
